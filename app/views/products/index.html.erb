<div class="flex flex-col">
  <%= form_with model: @product, method: :get, html: {class: "flex justify-center items-center gap-1"} do |form| %>
    <%= form.label :term, "Search by:" %>
    <%= form.text_field :term %>
    <%= form.submit "Search" %>
  <% end %>

  <div class="grid grid-cols-4 gap-2 p-2">
    <% if @products.empty? %>
      <p class="text-4xl text-red-500">No Records Found</p>
    <% else %>
      <% @products.each do |product| %>
        <div class="flex flex-col p-2 gap-2 text-lg border-2 border-slate-300 items-center">
          <p class="text-2xl"><%= product.name.capitalize %></p>
          <p>$ <%= number_with_precision(product.price, precision: 2) %></p>
          <p>Available: <%= product.stock %></p>

          <% if current_user && policy(product.likes).create? %>
            <% if product.liked_by? current_user %>
              <%= button_to "Dislike?", like_path(product.find_like(current_user)), method: :delete %>
            <% else %>
              <%= button_to "Like?", product_likes_path(product), method: :post %>
            <% end %>
          <% end %>

          <% if policy(product).update? %>
            <%= link_to "Edit product", edit_product_path(product) %>
            <%= button_to "Delete product", product_path(product), method: :delete %>
          <% end %>

          <div>
            <% if policy(@order_line).create? %>
              <%= form_with model: @order_line do |form| %>
                <%= form.hidden_field :product_id, value: product.id %>
                <div class="text-base">
                  <%= form.label :quantity %>
                </div>
                <%= form.number_field :quantity, required: true %>
                <%= form.submit "Add to Cart" %>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>

    <% if policy(@products).create? %>
      <button class="flex flex-col p-2 gap-2 text-lg border-2 border-slate-300">
        <%= link_to "New Product", new_product_path %>
      </button>
    <% end %>
  </div>
</div>

